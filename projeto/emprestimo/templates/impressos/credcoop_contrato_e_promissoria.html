{% extends "base_impressoes_refatorado.html" %}
{% load static %}
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <title>{{object.cliente.nome}}</title>
</head>

{% block content %}

    <div class="document">
        <div class="container">
            <div class="row justify-content-center">
                <h3>
                    <p class="font-weight-bold">
                        <u>CONTRATO DE MÚTUO FINANCEIRO</u>
                    </p>
                </h3>
            </div>

            <div class="row justify-content-center text-uppercase">
                <div class="text-center col-4 border border-dark">
                    <span class="font-weight-bold">
                        Nº do contrato
                    </span>
                    <br>
                    <span>{{object.n_contrato}}</span>
                </div>
                <div class="text-center col-1"></div>
                
                <div class="text-center col-4 border border-dark">
                    <span class="font-weight-bold">
                        Valor do crédito
                    </span>
                    <br>
                    <span>R$ {{object.valor_emprestado}}</span>
                </div>
            </div>

            <div>
                <p class="text-justify">
                    Pelo presente contrato particular de empréstimo de dinheiro,de um lado, 
                    Josimério de Abreu Silva, (Brasileiro, Solteiro, RG 1.791.746 SSP RN, CPF 029.388.274-66), 
                    de ora em diante denominado simplesmente por CREDOR, e, de outro lado, 
                    {{object.cliente.nome}}, (
                    {{object.cliente.nacionalidade}}, 
                    {{object.cliente.estado_civil}}, RG {{object.cliente.rg}}, {{object.cliente.orgao_expedidor}}, CPF 
                    {{object.cliente.cpf}}, 
                    {{object.cliente.rua}}, 
                    {{object.cliente.numero_casa}}, 
                    {{object.cliente.bairro}}, 
                    {{object.cliente.cidade}}, {{object.cliente.uf}}),  de ora em diante denominado simplesmente
                    DEVEDOR, têm justo e contratado o seguinte:
                </p>
            </div>

            
            {% if object.cliente.fiador.nome %}
                <div>
                    <p class="text-justify">
                        <strong>CLÁUSULA 1ª</strong>  - O <strong>DEVEDOR</strong> e seu(s) fiador(es) se comprometem a pagar ao <strong>CREDOR</strong> 
                        a título de empréstimo, a quantia acertada de R$ {{object.valor_devido}} (${real} reais e ${centavos} centavos), dividida em {{object.qtd_parcelas}} (${qtd_parcelas_extenso}) parcela(s) de iguais valores, já acrescidos de juros remuneratórios, nos moldes da legislação em vigor (Dec. 22.626/33 c/c art. 591 CC/02), pagas conforme boleto bancário, ou outro meio disponibilizado e pactuado, mediante as condições seguintes.
                    </p>
                </div>
            {% else %}
                <div>
                    <p class="text-justify">
                        <strong>CLÁUSULA 1ª</strong>  - O <strong>DEVEDOR</strong> se compromete a pagar ao <strong>CREDOR</strong> 
                        a título de empréstimo, a quantia acertada de R$ {{object.valor_devido}} (${real} reais e ${centavos} centavos), dividida em {{object.qtd_parcelas}} (${qtd_parcelas_extenso}) parcela(s) de iguais valores, já acrescidos de juros remuneratórios, nos moldes da legislação em vigor (Dec. 22.626/33 c/c art. 591 CC/02), pagas conforme boleto bancário, ou outro meio disponibilizado e pactuado, mediante as condições seguintes.
                    </p>
                </div>
            {% endif %}

            <div>
                <p class="text-justify" >
                    <b>CLÁUSULA 2ª</b> - Que a quantia acima emprestada, parcelada, deverá ser adimplida ao <b>CREDOR</b> no dia de acordo 
                    conforme tabela abaixo:
                </p>
            </div>

            <div class="row pt-4 px-5">
                <div class="col-12 px-5">
                    <div id = "tabela">
        
                    </div>
                </div>
            </div>

            
            <div>
                <p class="text-justify" >
                    <strong>CLÁUSULA 3ª</strong> - Na falta do pagamento do empréstimo na data aprazada, o <strong>DEVEDOR</strong> pagará uma multa de 
                    0.66% mais juros moratório sobre o débito de 2% por dia, acrescido de correção monetária sobre o montante apurado, 
                    ficando o <b>CREDOR</b> com direito de tomar as medidas judiciais cabíveis, inclusive a penhora judicial e conseguinte 
                    notificação e negativação nos órgãos de proteção creditícios SPC, SERASA, SCPC e afins, conforme art. 43 do estatuto 
                    consumerista.
                </p>
            </div>

            {% if object.cliente.fiador.nome %}
                <div>
                    <p class="text-justify" style="page-break-after:before">
                        <b>CLÁUSULA 4ª</b> - O(s) <b>FIADOR(ES)</b> na qualidade de devedor(es) principal e solidário, também presente neste ato e 
                        ao final qualificado e assinado, se compromete a honrar o presente contrato em seu inteiro teor, substituindo o <b>DEVEDOR</b>
                        em todas as obrigações contratuais assumidas, inclusive o pagamento pontual do principal, bem como os demais ônus enxertados 
                        neste contrato, quer decorrentes de acréscimos legais, quer de despesas judiciais se sujeitando aos ditames dos arts. 818 a 826, CC/02.
                    </p>
                </div>
            {% endif %}
            
            {% if object.cliente.fiador.nome %}
                <div>
                    <p class="text-justify" >
                        <b>CLÁUSULA 5ª</b> - Todos os encargos que venham a recair durante o período de inadimplência do <b>DEVEDOR</b>, 
                        como gastos judiciais e honorários, serão de inteira responsabilidade do <b>DEVEDOR</b>, devendo ser acrescidos na dívida 
                        originalmente pactuada.
                    </p>
                    <p class="text-justify">
                        <b>CLÁUSULA 6ª </b>- Fica eleito o foro desta cidade de Natal/RN, para dirimir qualquer dúvida referente a este contrato.
                    </p>
                    <p class="text-justify" >
                        E assim, por estarem plenamente contratados na forma acima e em consonância com a legislação em vigor, assinam o presente 
                        contrato em duas vias de igual teor, na presença de testemunhas que a tudo assistiram e conhecimento tiveram.
                    </p>
                </div>
                {% else %}
                <div>
                    <p class="text-justify" >
                        <b>CLÁUSULA 4ª</b> - Todos os encargos que venham a recair durante o período de inadimplência do <b>DEVEDOR</b>, 
                        como gastos judiciais e honorários, serão de inteira responsabilidade do <b>DEVEDOR</b>, devendo ser acrescidos na dívida 
                        originalmente pactuada.
                    </p>
                    <p class="text-justify">
                        <b>CLÁUSULA 5ª </b>- Fica eleito o foro desta cidade de Natal/RN, para dirimir qualquer dúvida referente a este contrato.
                    </p>
                    <p class="text-justify" >
                        E assim, por estarem plenamente contratados na forma acima e em consonância com a legislação em vigor, assinam o presente 
                        contrato em duas vias de igual teor, na presença de testemunhas que a tudo assistiram e conhecimento tiveram.
                    </p>
                </div>
            {% endif %}

            {% if object.cliente.fiador.nome %}
            <div class="container">
                <div class="row">
                    <div class="col-6 text-center">
                        _________________________________________
                    </div>
                    <div class="col-6 text-center">
                        _________________________________________
                    </div>
                </div>
                <div class="row">
                    <div class="col-6 text-center">
                        CREDOR
                    </div>
                    <div class="col-6 text-center ">
                        DEVEDOR
                    </div>
                </div>
            </div>
            
            <p class="fontmenor maiusculo">
                <strong>FIADOR 1:</strong> - 
                {{object.cliente.fiador.nome}}(
                {{object.cliente.fiador.estado_civil}}, RG{{object.cliente.fiador.rg}}
                {{object.cliente.fiador.orgao_expedidor}}, CPF 
                {{object.cliente.fiador.cpf}},             
                {{object.cliente.fiador.rua}}, 
                {{object.cliente.fiador.numero_casa}}, 
                {{object.cliente.fiador.bairro}}, 
                {{object.cliente.fiador.cidade}}, 
                {{object.cliente.fiador.uf}}).
            </p>
            <p style="text-align:center">
                ______________________________________________________________________________<br>
                ASSINATURA DO FIADOR
            </p>
            </br>
            </br>
            <p style="text-align:right" class="datacao">
                Natal-RN, {{ object.dt_emprestimo}}              
            </p>
            {% else %}
            <p style="text-align:right">
                Natal-RN, {{ object.dt_emprestimo}}             
            </p>
            <br>
            <br>
            <p style="text-align:center">
                ________________________________________________________________________________<br>
                CREDOR
            </p>
            <p class="fontmenor"></p>
    
            <p style="text-align:center">
                ________________________________________________________________________________<br>
                DEVEDOR
            </p>
            {% endif %}

        </div>
    </div>

    

{% endblock content %}

{% block js %}

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
{% comment %} <script src="{% static 'js/contrato.js' %}" crossorigin="anonymous"></script> {% endcomment %}

<script>
    window.onload = function tabela_de_vencimento(){
        var valor_emprestado   = Number({{object.valor_emprestado}})
        var qtd_parcelas       = Number({{object.qtd_parcelas}})
        var prestacao          = Number({{object.valor_prestacao}})
        //var n_contrato         = Number({{object.n_contrato}})        
        var principal          = valor_emprestado/qtd_parcelas  
        var mes_do_emprestimo  = Number({{object.dt_emprestimo.month}})
    
        var qtd_dias          = 0
        var iof_inicial       = 0
        var iof_diario        = 0.0041        
        var iof_adicional     = 0.0038  
    
    
    for (var i = 0 ; i < qtd_parcelas; i++){
        if(mes_do_emprestimo == 1 || mes_do_emprestimo == 3 || mes_do_emprestimo == 5 || mes_do_emprestimo == 7 || mes_do_emprestimo == 8 || mes_do_emprestimo == 10 || mes_do_emprestimo == 12){
            qtd_dias += 31
        }else{
            qtd_dias +=30
        }
        if(mes_do_emprestimo == 13){
            mes_do_emprestimo = 1
        }
        mes_do_emprestimo++
    }
    
    
        var valor_emprestado   = Number({{object.valor_emprestado}})                
        var qtd_parcelas       = Number({{object.qtd_parcelas}})
        var prestacao          = Number({{object.valor_prestacao}})
        var valor_parcela = 0
        var valor_devido = 0 
        valor_parcela = String(toFixed(valor_parcela, 2))
        
        var valor_total_devido = 0
        valor_total_devido = String(toFixed(valor_parcela*qtd_parcelas, 2))

        //VARIÁVEIS DA DATA DO EMPRESTIMO
        var contador_meses = 0
        var contador_anos  = 0
        var meses = new Array("01", "02", "03", "04", "05", "06" ,"07", "08", "09", "10", "11", "12")
        var dataEmprestimo = "{{ object.dt_emprestimo}}"
        var dt = new Date(dataEmprestimo)
        var dia
        var mes
        var ano
        var aux_dia = {{object.dt_emprestimo.day}}
        var aux_mes = {{object.dt_emprestimo.month}}
        var aux_ano = {{object.dt_emprestimo.year}}

        var trinta_e_um = 0
        
        dia  = aux_dia
        mes  = aux_mes+contador_meses
        ano  = aux_ano

        var contador_parcela = 0

        //CORREÇÃO DO VALOR TOTAL
        var valorTotal = parseFloat("{{object.valor_prestacao|floatformat:2}}".replace(',', '.'))
        var parceTotal = parseInt("{{object.qtd_parcelas|floatformat:2}}".replace(',', '.'))

        var resultado = 0 
        resultado = parseFloat(valorTotal*parceTotal).toFixed(2)
        resultado_ext = resultado
        resultado_int = parseInt(resultado_ext)
        resultado = resultado.replace('.', ',')

        var real = parseInt(resultado_ext)	
        real = String(real).extenso()
        
        var centavos = parseFloat((resultado_ext-resultado_int)).toFixed(2)	
        centavos = String(centavos).extenso()
    
        tabela.innerHTML +=       
        `
            <table class="table table-bordered mb-0 text-center">
                <thead>
                    <tr>
                        <th scope="col" width="33%" style="border: 2px solid black !important;">Nº PARCELAS</th>
                        <th scope="col" width="33%" style="border: 2px solid black !important;">VENCIMENTO</th>
                        <th scope="col" width="33%" style="border: 2px solid black !important;">VALOR</th>
                    </tr>
                </thead>
        `
        //VARIÁVEIS PARA AJUSTES DE DATA
        var primeiro = false
        var trinta_e_um = 0
        for(var i=0; i<{{object.qtd_parcelas}}; i++){
            mes++      
            
            if(dia == 1 && mes == 2 || dia == 1){
                primeiro = true
            }
            if(dia == 31){
                trinta_e_um = 31
            }            
            if(primeiro == false){
                //AJUSTA A DATA QUANDO O MES É FEVEREIRO E O DIA DO EMPRESTIMO FOI REALIZADO EM 30 OU 31
                if(dia == 1 && mes == 4){
                    dia = 30 
                    mes = 3                
                }
                if(dia == 30 && mes == 2){
                    dia = 1 
                    mes = 3
                }
                if(dia == 31 && mes == 2){
                    dia = 1 
                    mes = 3
                }
                // AJUSTE DE DIAS QUANDO A DATA INICIAL É DIA 31
                if(mes == 11 && trinta_e_um == 31){
                    dia--
                }
                if(dia == 30 && mes == 12 && trinta_e_um == 31){
                    dia++
                }
                if(dia == 30 && mes == 3 && trinta_e_um == 31){
                    dia++
                }
                if(mes == 4 && trinta_e_um == 31){
                    dia--
                }
                if(mes == 5 && trinta_e_um == 31){
                    dia++
                }
                if(mes == 6 && trinta_e_um == 31){
                    dia--
                }
                if(mes == 7 && trinta_e_um == 31){
                    dia++
                }
                if(mes == 9 && trinta_e_um == 31){
                    dia--
                }
                if(mes == 10 && trinta_e_um == 31){
                    dia++
                }
            }         
            if(primeiro == true){
                //AJUSTA A DATA QUANDO O MES É FEVEREIRO E O DIA DO EMPRESTIMO FOI REALIZADO EM 01 FEVEREIRO
                if(dia == 1 && mes == 3){
                    dia = 1 
                    mes = 3                
                }
            }        
            
            //AJUSTA MESES E ANOS 
            if(mes == 13){
                contador_meses = 0
                aux_mes = 1
                mes = 1	
                aux_ano++
                ano++				
            }
            
        tabela.innerHTML +=
            `
                <table class="table table-bordered mb-0 text-center">
                    <tbody>
                        <tr>
                            <td class="py-0" width="33%" style="border: 1px solid black !important;">${i+1}/${"{{ object.qtd_parcelas}}"}</td>
                            <td class="py-0" width="33%" style="border: 1px solid black !important;">${dia}/${meses[mes-1]}/${ano}</td>
                            <td class="py-0" width="33%" style="border: 1px solid black !important;">R$ ${"{{ object.valor_prestacao}}"}</td>
                        </tr>
                    </tbody>
                </table>
                
            `
        }
    }
</script>

{% endblock js %}